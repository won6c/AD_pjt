{% extends 'base.html' %}

{% block title %}ğŸ“š ë„ì„œ ê²€ìƒ‰ ì‹œìŠ¤í…œ{% endblock %}

{% block content %}
<h1 class="text-center mb-4">ğŸ“š ë„ì„œ ê²€ìƒ‰ ì‹œìŠ¤í…œ</h1>

<form method="get" action="{% url 'library:book_search' %}" class="d-flex justify-content-center mb-4 gap-2">
  <input type="text" name="query" class="form-control w-25" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="{{ query }}">
  <select name="field" class="form-select w-auto">
    <option value="title" {% if field == 'title' %}selected{% endif %}>ì œëª©</option>
    <option value="author" {% if field == 'author' %}selected{% endif %}>ì €ì</option>
    <option value="keyword" {% if field == 'keyword' %}selected{% endif %}>í‚¤ì›Œë“œ</option>
  </select>
  <select name="order" class="form-select w-auto">
    <option value="title" {% if order == 'title' %}selected{% endif %}>ì œëª©ìˆœ</option>
    <option value="author" {% if order == 'author' %}selected{% endif %}>ì €ììˆœ</option>
    <option value="date" {% if order == 'date' %}selected{% endif %}>ì¶œê°„ì¼ìˆœ</option>
  </select>
  <button type="submit" class="btn btn-primary">ê²€ìƒ‰</button>
  <a href="{% url 'library:book_recommend' %}?query={{ query }}" class="btn btn-success">
    ğŸ“– AI ì¶”ì²œ
  </a>
</form>

<div class="mx-auto" style="max-width: 700px;">
  {% if page_obj.object_list %}
    {% for book in page_obj %}
    <div class="p-3 border-bottom">
      <h5 class="fw-bold text-primary">
        <a href="{% url 'library:book_detail' book.id %}" class="text-decoration-none text-primary">
          {{ book.title }}
        </a>
      </h5>
      <div class="text-muted small">{{ book.author }} / {{ book.published_date }}</div>
    </div>
    {% endfor %}
  {% else %}
    <p class="text-center">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endif %}
</div>

<!-- âœ… í˜ì´ì§€ë„¤ì´ì…˜ ì˜ì—­ -->
{% if page_obj.has_other_pages %}
<div class="d-flex justify-content-center mt-4">
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?query={{ query }}&field={{ field }}&order={{ order }}&page={{ page_obj.previous_page_number }}">
          â† ì´ì „
        </a>
      </li>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
      {% if num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %}
        <li class="page-item {% if num == page_obj.number %}active{% endif %}">
          <a class="page-link" href="?query={{ query }}&field={{ field }}&order={{ order }}&page={{ num }}">{{ num }}</a>
        </li>
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?query={{ query }}&field={{ field }}&order={{ order }}&page={{ page_obj.next_page_number }}">
          ë‹¤ìŒ â†’
        </a>
      </li>
    {% endif %}
  </ul>
</div>
{% endif %}
{% endblock %}
